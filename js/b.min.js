function init(e){function t(){let e=quest_post(1),t=read(e);console.log(e),1==parseInt(t[0])?(questProgress.progress=JSON.parse('{"six_id":"","start_time":{"quest_1":0,"quest_2":0,"quest_3":0,"quest_4":0,"quest_5":0},"accomplish_time":{"quest_1":0,"quest_2":0,"quest_3":0,"quest_4":0,"quest_5":0}}'),questProgress.inited=!0,questProgress.progress.six_id=t[1],alert("你的识别代码是:"+t[1]+String.fromCharCode(10)+"请牢记这段代码，以便恢复进度和兑奖")):32==parseInt(t[0])&&questProgress.get_progress_from_server(!0)}if(null!=e&&""!=e)return quest_post(6,e,"","");t()}function quest_post(e,s,n,o,i,r){function c(){function i(e,t){return""==t||null==t?"":e+t}var r="",c=0;m=i("m=",e),t=i("t=",s),q=i("q=",n),a=i("a=",o),ar=[m,t,q,a];for(var d=0;d<=3;d++)""!=ar[d]&&(r+=0==c?ar[d]:"&"+ar[d],c++);return r}0==Boolean&&(i=!1);let d=new XMLHttpRequest,l=c();if(d.open("POST","quest.php",i),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(l),!i)return d.responseText;d.onreadystatechange=function(){4==d.readyState&&200==d.status&&r(d.responseText)}}function read(e){let t,s,n=e.length,o=[];return"{"==e.slice(0,1)&&"}"==e.slice(n-1,n)&&(t=e.indexOf(","),s=e.lastIndexOf(","),o[0]=e.slice(1,t),o[2]=e.slice(s+1,n-1),""!=o[2]&&(o[1]=e.slice(t+1,s)),o)}function do_answer(e,t){quest_post("","",e,t,!0,function(t){let s=read(t);switch(parseInt(s[0])){case 41:5==e?(boo=!1,feedback.rightAnswer(e,void 0,ans[e-1],sta[e-1],!1),setTimeout(function(){move.unlockArrC(6),move.move(1),update_show_6_id(questProgress.progress.six_id)},2e3)):feedback.rightAnswer(e,void 0,ans[e-1],sta[e-1],!0);break;case 42:feedback.wrongAnswer(ans[e-1],ans[e-1],sta[e-1]);break;case 43:feedback.hasBeenAccomplished(e,void 0,ans[e-1],sta[e-1]);break;case 44:sta[e-1].innerHTML="题号错误！"}})}function answer(e){4!=e?do_answer(e,ans[e-1].value):do_answer(4,rotate.roT[0].toString()+rotate.roT[1].toString()+rotate.roT[2].toString())}function reg_start_time(e){quest_post(7,"",e,"",!0,function(t){let s=read(t);switch(parseInt(s[0])){case 1:break;case 11:console.log("reg_start_time:ERR_QUEST,q="+e);break;case 31:console.log("reg_start_time:PROGRESS_NOT_INIT")}})}function setCookie(e,t,s){var n=new Date;n.setTime(n.getTime()+24*s*60*60*1e3);var o="expires="+n.toGMTString();document.cookie=e+"="+t+"; "+o}function getCookie(e){for(var t=e+"=",s=document.cookie.split(";"),n=0;n<s.length;n++){var o=s[n].trim();if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}function update_show_6_id(e){for(var t=0;t<show_6_id.length;t++)show_6_id[t].innerHTML=e}function show_sessid(){clickCount>0?(document.getElementById("d_sess_id_show").hidden=!1,document.getElementById("sess_id_show").value=getCookie("PHPSESSID"),clickCount=0):clickCount++}function do_hide_sess_id(){document.getElementById("d_sess_id_show").hidden=!0}var ans=[],sta=[],questProgress={_progress:void 0,changeListeners:[],get progress(){return _progress},set progress(e){_progress=e;for(let e=0;e<this.changeListeners.length;e++)this.changeListeners[e].call()},addChangeListener:function(e){this.changeListeners.push(e)},inited:!1,get_progress_from_server:function(e){let t=this;quest_post(2,"","","",!0,function(s){let n=read(s);1==parseInt(n[0])&&21==parseInt(n[2])&&(t.progress=JSON.parse(n[1]),t.inited=!0,1==e&&t.recoverProgress())})},ifQuestAccomplished:function(e){return 0!=this.progress.accomplish_time["quest_"+e]},ifQuestStarted:function(e){return 0!=this.progress.start_time["quest_"+e]},recoverProgress:function(){for(let e=1;e<=5;e++)this.ifQuestStarted(e)&&move.unlockArrC(e),this.ifQuestAccomplished(e)&&(feedback.hasBeenAccomplished(e,void 0,ans[e-1]),move.unlockArrC(e))}};feedback={eleAudio:[],nowPlaying:void 0,initSoundEffect:function(e){let t=this.eleAudio.push(document.createElement("audio"))-1,s=document.createElement("source");s.src=e,s.type="audio/mp3",this.eleAudio[t].appendChild(s),this.eleAudio[t].loop=!1},playSoundEffect:function(e){return this.eleAudio[e].play(),this.nowPlaying=this.eleAudio[e],0},stopSoundEffect(){this.nowPlaying.pause(),this.nowPlaying.currentTime=0,(this.nowPlaying.paused=!0)&&(this.nowPlaying=void 0)},rightAnswer:function(e,t,s,n,o){this.do_Shakes(t),null!=s&&(this.clearChangeColor(s),s.classList.add("border"),s.classList.add("border-success"),s.classList.add("bg-success")),null!=n&&(n.innerHTML="恭喜你，答对了！"),null!=o&&1==o&&(move.unlockArrC(e+1),move.move(1),reg_start_time(e+1)),this.playSoundEffect(1)},wrongAnswer:function(e,t,s){this.do_Shakes(e),null!=t&&(this.clearChangeColor(t),t.classList.add("border"),t.classList.add("border-danger"),t.classList.add("bg-danger")),null!=s&&(s.innerHTML="答案错误，再好好想想吧！"),this.playSoundEffect(0)},hasBeenAccomplished:function(e,t,s,n){this.do_Shakes(t),null!=s&&(this.clearChangeColor(s),s.classList.add("border"),s.classList.add("border-success"),s.classList.add("bg-success")),null!=n&&(n.innerHTML="你已经答对过这道题了！"),move.unlockArrC(e+1),move.move(1)},do_Shakes:function(e){null!=e&&(e.classList.add("shake"),asyncShakesClear=function(){setTimeout(function(){e.classList.remove("shake")},600)},e.addEventListener("animationend",asyncShakesClear))},clearShakes:function(e,t){e.classList.remove("shake")},clearChangeColor:function(e){e.classList.remove("border-danger"),e.classList.remove("bg-danger"),e.classList.remove("border-success"),e.classList.remove("bg-success")},show:function(e){e.hidden=!1}};for(let e=0;e<=4;e++)ans[e]=document.getElementById("answer_"+(e+1)),sta[e]=document.getElementById("status_"+(e+1));var move={min:0,now:0,max:0,touching:0,preventMove:!1,elementToTranslate:void 0,arrContainers:void 0,eleTransContainer:void 0,arrCbool:[],previousScrollY:void 0,movedDistance:0,lastKnownTouchPageY:0,move:function(e){move.preventMove||this.doMove(e)},moveTo:function(e){this.doMove(e-this.now)},doChangeHidden:function(e,t,s){if(t-e==0)return this.arrContainers[e].hidden=s,0;for(let n=e;n<=t;n++)this.arrContainers[n].hidden=s},doMove:function(e){function t(e){return 0!=n.arrCbool[e]}var s=this.now,n=this;if(e>0)if(this.now+e<=this.max){if(!t(this.now+e))return!1;this.doChangeHidden(this.now,this.now+e,!1);for(let t=this.now;t<this.now+e;t++)this.movedDistance+=this.arrContainers[t].clientHeight;this.now=this.now+e}else{if(!t(this.max))return!1;this.doChangeHidden(this.now,this.max,!1);for(let e=this.now;e<this.max;e++)this.movedDistance+=this.arrContainers[e].clientHeight;this.now=this.max}else if(e<0){if(this.now+e>=this.min){if(!t(this.now+e))return!1;for(let t=this.now;t>this.now+e;t--)this.movedDistance-=this.arrContainers[t-1].clientHeight;this.now=this.now+e}else{if(!t(this.min))return!1;for(let e=this.now;e>this.min;e--)this.movedDistance-=this.arrContainers[e-1].clientHeight;this.now=this.min}function o(e){if("transform"!=e.propertyName)return 1;s==n.now&&s++,n.doChangeHidden(s,n.max,!0),n.elementToTranslate.removeEventListener("transitionend",o)}this.elementToTranslate.addEventListener("transitionend",o)}return this.elementToTranslate.style.transform="translate(0,-"+this.movedDistance+"px)",!0},setElementToTranslate:function(e){this.elementToTranslate=e},setContainer:function(e){this.arrContainers=e,this.max=e.length-1},setInput:function(e){function t(e){e.preventDefault()}if(null==e)return 1;let s=this,n=function(e){s.previousScrollY=window.scrollY,s.preventMove=!0,window.scroll({top:s.previousScrollY+e.target.offsetTop/7,behavior:"smooth"}),document.body.addEventListener("touchmove",t,{passive:!1})},o=function(e){s.preventMove=!1,window.scroll({top:s.previousScrollY,behavior:"smooth"}),document.body.removeEventListener("touchmove",t,{passive:!1})};for(let t=0;t<e.length;t++)e[t].onblur=o,e[t].onfocus=n},unlockArrC:function(e){this.arrCbool[e]=!0},lockArrC:function(e){this.arrCbool[e]=!1},init:function(e,t,s,n){this.setContainer(t),this.setElementToTranslate(e),this.setInput(s),this.doChangeHidden(this.min+1,this.max,!0),this.eleTransContainer=n;for(let e=this.min+1;e<=this.max;e++)this.arrCbool[e]=!1;var o=this;document.onkeypress=function(e){switch(e.keyCode){case 115:o.move(1);break;case 119:o.move(-1)}}}},rotate={c:void 0,roT:[],last:[],init:function(e,t){this.c=t;var s=this;for(let t=0;t<s.c.length;t++)s.roT[t]=1,s.c[t].onclick=function(){let n=new Date,o=n.getTime();o-s.last[t]<.95*e||(s.last[t]=o,s.c[t].style.animation="rotate"+s.roT[t]+" "+e+"ms forwards",4==s.roT[t]&&(s.roT[t]=0),s.roT[t]++)}}};move.init(document.getElementById("display-container"),document.getElementsByClassName("block-container"),document.getElementsByTagName("input"),document.getElementsByClassName("main")[0]),rotate.init(1e3,document.getElementsByClassName("rotate")),ip_6_id=document.getElementById("ip_6_id"),show_6_id=document.getElementsByClassName("show_6_id"),feedback.initSoundEffect("Villagerdeny1.mp3"),feedback.initSoundEffect("Villageraccept2.mp3"),buttoninit=function(){var e=document.getElementsByClassName("ycsubmit"),t=function(e){let t=parseInt(this.getAttribute("data-q"));if(0==t){if(!questProgress.inited){if(""!=ip_6_id.value){let e=ip_6_id.value;if(6!=e.length)return alert("请输入6位数字！"),feedback.wrongAnswer(ip_6_id,ip_6_id),1;{let t=init(e),s=!0;switch(parseInt(read(t)[0])){case 1:questProgress.get_progress_from_server(!0),s=!1;break;case 12:console.log("todo:init(from 6_id):wrong params,"+sixid);break;case 50:console.log("todo:init(from 6_id):LIST_FILE_NOT_CREATED");break;case 51:console.log("todo:init(from 6_id):LIST_FILE_OPEN_FAILED");break;case 52:window.confirm("没有发现对应该id的存档，是否创建一个新的游戏进程？")&&(init(),s=!1)}if(s)return 1}}else init();move.unlockArrC(1),reg_start_time(1)}move.move(1)}else answer(t)};for(let s=0;s<e.length;s++)e[s].addEventListener("click",t)}(),get_sixid_from_cookie=function(){let e=getCookie("six_id");if(""!=e)update_show_6_id(getCookie("six_id"));else{var t=read(quest_post(2,"","","",!1)),s=JSON.parse(t[1]);null!=s.six_id?update_show_6_id(s.six_id):(show_6_id[0].innerHTML="暂未读取到你的游戏记录<br>如果你是新玩家，请直接按下一步",show_6_id[1].innerHTML="NULL")}}(),sixidtrack=void questProgress.addChangeListener(function(){update_show_6_id(questProgress.progress.six_id)});var clickCount=0;